%h2 Asetukset
= simple_form_for @profile, :html => {:id => "edit_profile_form"} do |f|
  = f.input :first_names
  = f.input :first_name
  = f.input :last_name
  = f.input :image, :wrapper_html => {:style => "float: left;"}
  %img.avatar{ src: current_citizen.image, width: 48, height: 48,
               style: "margin: 1em;", alt: "avatar" }
  %br{:style => "clear: both;"}
  = f.input :receive_newsletter
  = f.input :receive_other_announcements
  = f.input :receive_weekletter
  = f.input :accept_science
  = f.input :accept_terms_of_use, :disabled => true
  = f.submit "Tallenna asetukset", :id => "save-settings"

= link_to "Vaihda sähköpostiosoite tai salasana", edit_citizen_path

:javascript
  $("#profile_accept_terms_of_use").change(function() {
    if ($("#profile_accept_terms_of_use").attr("checked")) {
      $("#save-settings").attr({"disabled": false})
      $("#save-settings").removeClass("disabled")
    }
    else {
      $("#save-settings").attr({"disabled": true})
      $("#save-settings").addClass("disabled")
    }})
  $("#profile_accept_terms_of_use").attr({"disabled": false})
  $("#profile_accept_terms_of_use").removeClass("disabled")
  $("#profile_accept_terms_of_use").parent().removeClass("disabled")
  
  var savingIndicator = document.createElement("div")
  
  var spinner = document.createElement("img")
  spinner.src = "/assets/spinner.gif"
  spinner.alt = "Tallennetaan kuvaa..."
  var text = document.createTextNode("Tallennetaan kuvaa...")
  
  savingIndicator.appendChild(spinner)
  savingIndicator.appendChild(text)
  
  $("#edit_profile_form").submit(function() {
    if ($("#profile_image")[0].value != "") {
      // saving the picture takes around 30 seconds,
      // so let's warn the citizen about that
      $("#edit_profile_form").after(savingIndicator)
    }
  })
